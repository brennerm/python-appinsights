


<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Application Insights SDK for Python &#8212; Application Insights SDK for Python 0.12.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/overrides.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="applicationinsights module" href="applicationinsights.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="applicationinsights.html" title="applicationinsights module"
             accesskey="N">next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Application Insights SDK for Python 0.12.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="application-insights-sdk-for-python">
<h1>Application Insights SDK for Python<a class="headerlink" href="#application-insights-sdk-for-python" title="Permalink to this headline">¶</a></h1>
<div class="sidebar">
<p class="sidebar-title">Usage</p>
<p>Once installed, you can send telemetry to Application Insights. Here are a few samples.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#usage-sample-01"><span class="std std-ref">Sending a simple event telemetry item</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-02"><span class="std std-ref">Sending an event telemetry item with custom properties and measurements</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-03"><span class="std std-ref">Sending a trace telemetry item with custom properties</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-04"><span class="std std-ref">Sending a metric telemetry item</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-05"><span class="std std-ref">Sending an exception telemetry item with custom properties and measurements</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-06"><span class="std std-ref">Configuring context for a telemetry client instance</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-07"><span class="std std-ref">Configuring channel related properties</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-08"><span class="std std-ref">Configuring synchronous (default) channel properties</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-09"><span class="std std-ref">Configuring an asynchronous channel instead of the synchronous default</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-10"><span class="std std-ref">Configuring asynchronous channel properties</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-11"><span class="std std-ref">Basic logging configuration (first option)</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-12"><span class="std std-ref">Basic logging configuration (second option)</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-13"><span class="std std-ref">Advanced logging configuration</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-14"><span class="std std-ref">Logging unhandled exceptions</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-15"><span class="std std-ref">Logging requests</span></a></p></li>
<li><p><a class="reference internal" href="#usage-sample-16"><span class="std std-ref">Integrating with Django</span></a></p></li>
</ul>
</div>
<p>This project extends the Application Insights API surface to support Python. <a class="reference external" href="http://azure.microsoft.com/en-us/services/application-insights/">Application
Insights</a> is a service that allows developers to keep their application available, performing and succeeding. This Python module will allow you to send telemetry of various kinds (event, trace, exception, etc.) to the Application Insights service where they can be visualized in the Azure Portal.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>Python 2.7 and Python 3.4 are currently supported by this module.</p>
<p>For opening the project in Microsoft Visual Studio you will need <a class="reference external" href="http://pytools.codeplex.com/">Python Tools for Visual Studio</a>.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To install the latest release you can use <a class="reference external" href="http://www.pip-installer.org/">pip</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install applicationinsights
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>Once installed, you can send telemetry to Application Insights. Here are a few samples.</p>
<blockquote>
<div><p><strong>Note</strong>: before you can send data to you will need an instrumentation key. Please see the <a class="reference external" href="https://github.com/Microsoft/AppInsights-Home/wiki#getting-an-application-insights-instrumentation-key">Getting an Application Insights
Instrumentation Key</a>
section for more information.</p>
</div></blockquote>
<p id="usage-sample-01"><strong>Sending a simple event telemetry item</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">track_event</span><span class="p">(</span><span class="s2">&quot;Test event&quot;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-02"><strong>Sending an event telemetry item with custom properties and measurements</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">track_event</span><span class="p">(</span><span class="s1">&#39;Test event&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span> <span class="p">},</span> <span class="p">{</span> <span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="mi">42</span> <span class="p">})</span>
<span class="n">tc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-03"><strong>Sending a trace telemetry item with custom properties</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">track_trace</span><span class="p">(</span><span class="s1">&#39;Test trace&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span> <span class="p">})</span>
<span class="n">tc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-04"><strong>Sending a metric telemetry item</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">track_metric</span><span class="p">(</span><span class="s1">&#39;My Metric&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-05"><strong>Sending an exception telemetry item with custom properties and measurements</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;blah&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">track_exception</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;blah&quot;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">tc</span><span class="o">.</span><span class="n">track_exception</span><span class="p">(</span><span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">(),</span> <span class="n">properties</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span> <span class="p">},</span> <span class="n">measurements</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">42</span> <span class="p">})</span>

<span class="n">tc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-06"><strong>Configuring context for a telemetry client instance</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="s1">&#39;1.2.3&#39;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;My current device&#39;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">oem_name</span> <span class="o">=</span> <span class="s1">&#39;Asus&#39;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;X31A&#39;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s2">&quot;Other&quot;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s1">&#39;santa@northpole.net&#39;</span>
<span class="n">tc</span><span class="o">.</span><span class="n">track_trace</span><span class="p">(</span><span class="s1">&#39;My trace with context&#39;</span><span class="p">)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-07"><strong>Configuring channel related properties</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="c1"># flush telemetry every 30 seconds (assuming we don&#39;t hit max_queue_item_count first)</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">send_interval_in_milliseconds</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">1000</span>
<span class="c1"># flush telemetry if we have 10 or more telemetry items in our queue</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">max_queue_length</span> <span class="o">=</span> <span class="mi">10</span>
</pre></div>
</div>
<p id="usage-sample-08"><strong>Configuring synchronous (default) channel properties</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="c1"># flush telemetry if we have 10 or more telemetry items in our queue</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">max_queue_length</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># send telemetry to the service in batches of 5</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">send_buffer_size</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p id="usage-sample-09"><strong>Configuring an asynchronous channel instead of the synchronous default</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span><span class="p">,</span> <span class="n">channel</span>
<span class="n">sender</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">AsynchronousSender</span><span class="p">()</span>
<span class="n">queue</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">AsynchronousQueue</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
<span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">::</span><span class="n">TelemetryChannel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
<span class="c1"># Note: the event will be sent on a separate thread; if the app finishes before</span>
<span class="c1">#       the thread finishes, the data is lost</span>
<span class="n">tc</span><span class="o">.</span><span class="n">track_event</span><span class="p">(</span><span class="s1">&#39;My event&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p id="usage-sample-10"><strong>Configuring asynchronous channel properties</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights</span> <span class="kn">import</span> <span class="n">TelemetryClient</span><span class="p">,</span> <span class="n">channel</span>
<span class="n">sender</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">AsynchronousSender</span><span class="p">()</span>
<span class="n">queue</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">AsynchronousQueue</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
<span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span><span class="p">::</span><span class="n">TelemetryChannel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
<span class="n">tc</span> <span class="o">=</span> <span class="n">TelemetryClient</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">,</span> <span class="n">channel</span><span class="p">)</span>
<span class="c1"># flush telemetry if we have 10 or more telemetry items in our queue</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">max_queue_length</span> <span class="o">=</span> <span class="mi">10</span>
<span class="c1"># send telemetry to the service in batches of 5</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">send_buffer_size</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># the background worker thread will be active for 5 seconds before it shuts down. if</span>
<span class="c1"># during this time items are picked up from the queue, the timer is reset.</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">send_time</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># the background worker thread will poll the queue every 0.5 seconds for new items</span>
<span class="n">tc</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">send_interval</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
<p id="usage-sample-11"><strong>Basic logging configuration (first option)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">applicationinsights.logging</span> <span class="kn">import</span> <span class="n">enable</span>

<span class="c1"># set up logging</span>
<span class="n">enable</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>

<span class="c1"># log something (this will be sent to the Application Insights service as a trace)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;This is a message&#39;</span><span class="p">)</span>

<span class="c1"># logging shutdown will cause a flush of all un-sent telemetry items</span>
<span class="c1"># alternatively flush manually via handler.flush()</span>
</pre></div>
</div>
<p id="usage-sample-12"><strong>Basic logging configuration (second option)</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">applicationinsights.logging</span> <span class="kn">import</span> <span class="n">LoggingHandler</span>

<span class="c1"># set up logging</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">handlers</span><span class="o">=</span><span class="p">[</span> <span class="n">handler</span> <span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># log something (this will be sent to the Application Insights service as a trace)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;This is a message&#39;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Some exception&#39;</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># this will send an exception to the Application Insights service</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Code went boom!&#39;</span><span class="p">)</span>

<span class="c1"># logging shutdown will cause a flush of all un-sent telemetry items</span>
<span class="c1"># alternatively flush manually via handler.flush()</span>
</pre></div>
</div>
<p id="usage-sample-13"><strong>Advanced logging configuration</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">applicationinsights.logging</span> <span class="kn">import</span> <span class="n">LoggingHandler</span>

<span class="c1"># set up logging</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">LoggingHandler</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">my_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;simple_logger&#39;</span><span class="p">)</span>
<span class="n">my_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">my_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="c1"># log something (this will be sent to the Application Insights service as a trace)</span>
<span class="n">my_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;This is a message&#39;</span><span class="p">)</span>

<span class="c1"># logging shutdown will cause a flush of all un-sent telemetry items</span>
<span class="c1"># alternatively flush manually via handler.flush()</span>
</pre></div>
</div>
<p id="usage-sample-14"><strong>Logging unhandled exceptions</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">applicationinsights.exceptions</span> <span class="kn">import</span> <span class="n">enable</span>

<span class="c1"># set up exception capture</span>
<span class="n">enable</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">)</span>

<span class="c1"># raise an exception (this will be sent to the Application Insights service as an exception telemetry object)</span>
<span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Boom!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p id="usage-sample-15"><strong>Logging requests</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">applicationinsights.requests</span> <span class="kn">import</span> <span class="n">WSGIApplication</span>

<span class="c1"># instantiate the Flask application and wrap its WSGI application</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span> <span class="o">=</span> <span class="n">WSGIApplication</span><span class="p">(</span><span class="s1">&#39;&lt;YOUR INSTRUMENTATION KEY GOES HERE&gt;&#39;</span><span class="p">,</span> <span class="n">app</span><span class="o">.</span><span class="n">wsgi_app</span><span class="p">)</span>

<span class="c1"># define a simple route</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>

<span class="c1"># run the application</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p id="usage-sample-16"><strong>Integrating with Django</strong></p>
<p>Place the following in your <cite>settings.py</cite> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># If on Django &lt; 1.10</span>
<span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... or whatever is below for you ...</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
    <span class="c1"># ... or whatever is above for you ...</span>
    <span class="s1">&#39;applicationinsights.django.ApplicationInsightsMiddleware&#39;</span><span class="p">,</span>   <span class="c1"># Add this middleware to the end</span>
<span class="p">]</span>

<span class="c1"># If on Django &gt;= 1.10</span>
<span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ... or whatever is below for you ...</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
    <span class="c1"># ... or whatever is above for you ...</span>
    <span class="s1">&#39;applicationinsights.django.ApplicationInsightsMiddleware&#39;</span><span class="p">,</span>   <span class="c1"># Add this middleware to the end</span>
<span class="p">]</span>

<span class="n">APPLICATION_INSIGHTS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># (required) Your Application Insights instrumentation key</span>
    <span class="s1">&#39;ikey&#39;</span><span class="p">:</span> <span class="s2">&quot;00000000-0000-0000-0000-000000000000&quot;</span><span class="p">,</span>

    <span class="c1"># (optional) By default, request names are logged as the fully-qualified</span>
    <span class="c1"># name of the view.  To disable this behavior, specify:</span>
    <span class="s1">&#39;use_operation_url&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

    <span class="c1"># (optional) By default, arguments to views are tracked as custom</span>
    <span class="c1"># properties.  To disable this, specify:</span>
    <span class="s1">&#39;record_view_arguments&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

    <span class="c1"># (optional) Events are submitted to Application Insights asynchronously.</span>
    <span class="c1"># send_interval specifies how often the queue is checked for items to submit.</span>
    <span class="c1"># send_time specifies how long the sender waits for new input before recycling</span>
    <span class="c1"># the background thread.</span>
    <span class="s1">&#39;send_interval&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="c1"># Check every second</span>
    <span class="s1">&#39;send_time&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span> <span class="c1"># Wait up to 3 seconds for an event</span>

    <span class="c1"># (optional, uncommon) If you must send to an endpoint other than the</span>
    <span class="c1"># default endpoint, specify it here:</span>
    <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="s2">&quot;https://dc.services.visualstudio.com/v2/track&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will log all requests and exceptions to the instrumentation key
specified in the <cite>APPLICATION_INSIGHTS</cite> setting.  In addition, an
<cite>appinsights</cite> property will be placed on each incoming <cite>request</cite> object in
your views.  This will have the following properties:</p>
<ul class="simple">
<li><p><cite>client</cite>: This is an instance of the <a class="reference internal" href="applicationinsights.html#applicationinsights.TelemetryClient" title="applicationinsights.TelemetryClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">applicationinsights.TelemetryClient</span></code></a> type, which will
submit telemetry to the same instrumentation key, and will parent each telemetry item to the current
request.</p></li>
<li><p><cite>request</cite>: This is the <a class="reference internal" href="applicationinsights.channel.contracts.html#applicationinsights.channel.contracts.RequestData" title="applicationinsights.channel.contracts.RequestData"><code class="xref py py-class docutils literal notranslate"><span class="pre">applicationinsights.channel.contracts.RequestData</span></code></a> instance for the
current request.  You can modify properties on this object during the handling of the current request.
It will be submitted when the request has finished.</p></li>
<li><p><cite>context</cite>: This is the <a class="reference internal" href="applicationinsights.channel.html#applicationinsights.channel.TelemetryContext" title="applicationinsights.channel.TelemetryContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">applicationinsights.channel.TelemetryContext</span></code></a> object for the current
ApplicationInsights sender.</p></li>
</ul>
<p>You can also hook up logging to Django.  For example, to log all builtin
Django warnings and errors, use the following logging configuration in
<cite>settings.py</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># The application insights handler is here</span>
        <span class="s1">&#39;appinsights&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;applicationinsights.django.LoggingHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;WARNING&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;appinsights&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;WARNING&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See Django’s logging documentation for more information:
<a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/logging/">https://docs.djangoproject.com/en/1.11/topics/logging/</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Application Insights SDK for Python</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#usage">Usage</a></li>
</ul>
</li>
</ul>

  <h4>Next topic</h4>
  <p class="topless"><a href="applicationinsights.html"
                        title="next chapter">applicationinsights module</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="applicationinsights.html" title="applicationinsights module"
             >next</a> |</li>
        <li class="nav-item nav-item-0"><a href="#">Application Insights SDK for Python 0.12.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Max Brenner.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>